---
title: "Advanced tree manipulation and Visualisation - Part 1".
author: "Eve Zeyl Fiskebeck & HÃ¥kon Kaspersen"
date: "`r format(Sys.time(), '%d %B, %Y')`"

params:
  repo_path: "https://github.com/NorwegianVeterinaryInstitute/nvi-documentation/tree/evfi_ggtree_dev/docs/source/tutorials"  
  

output: github_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, echo = FALSE}
library(pacman)
p_load(here, ggtree)

knitr::opts_chunk$set(
  collapse = F, eval = FALSE, 
  fig.path = "./")
```

<!-- REMEMBER - 
- [ ] At merging in main change the repo_path to main branch
--> 

# Phylogenetic tree (re-)rooting

There are different ways to root phylogenetic trees, Eg. using an outgroup, 
using midpoint rooting, using molecular clock hypothesis and tip dating (eg. see 
bactdating) or using non-time reversible nucleotide substitutions models.

- Maximum likelihood phylogenetic trees are unrooted when we use time reversible models 
![GTR faimily](https://d3i71xaburhd42.cloudfront.net/313ab4728900e96d7eaff5c8db8fe30f1f702afb/7-Figure4-1.png).

But there are ways in IQ-Tree to find the root using eg. non reversible models. 
[See here](http://www.iqtree.org/doc/Rootstrap)

Here we will show you how to import unrooted tree and re-root it for visualization
with ggtree. We experienced many times challenges to correctly re-root the tree. 
If incorrectly done, it can shift the bootstrap values at the wrong place.

You can read eg. a general explanation of why [here:](https://academic.oup.com/mbe/article/34/6/1535/3077051). In summary, its 
because bootstrap values are support values of branches, but because they are
often displayed on the nodes it leads to confusion (and also improper mechanism
when rooting). 

Therefore we advise you that you ensure that each re-rooting you have done did not
shift the bootstrap values and that your visualization is correct.
You can do so, eg. using [FigTree](http://tree.bio.ed.ac.uk/software/figtree/) (using bootstrap as branch support to be correct). FigTree can eg. be installed via conda. 

## Downloading the data for this tutorial 

```{r}
mytree <- readRDS(paste(params$repo_path, "tree.RDS", sep = "/"))
```



- [ ] Write

## Outgroup rooting




## Mid-point rooting

During mid point rooting, the root will be placed in the middle of the longest 
branch (aka. longest evolutionary distance) between OTU/groups, because this 
branch represents the most distantly related OTU. 

Midpoint rooting is useful when you do not have other information about where 
the root should be AND want to give a directionality of evolution, 
for interpretation. HOWEVER, you need to think before mid-point rooting, about
the assumption you are making and be conscious that I can be misleading and 
erroneous.

Here is an example of me not thinking before doing! 
(hope you can learn from my mistake)

<!-- we use apec2021 -> showing also the problem of when middle rerooting 
is wrong -->

-[ ] History - large cluster
-[ ] History - misleading interpretation with midpoint rooting



# References

-[ ] [ggtree book]()

<!-- Continue  

# Heatmaps 
## Heatmaps - presentation of data on the side ie AMR / other stuff

### Tutorial section 

# ggtree extra library

## Distances heatmaps
### Data for this tutorial section 
> could we also use the apec 2021 ? 

### Tutorial section 

Eve tree/rotated/tree and phylogeny

> can also use part of that to show how to create weird composite color scales
> getting the distances in a proper format for display - Apec2021 (Is ready there)
might just need to improve the documentation of the function

# Manipulating tree data formats
> advantages
- avoid the NA when plotting
- merging directly metadata and tree (sure its not a problem when plotting)


## Facets -> Phylogeography
### Data for this tutorial section 
> here maybe should use a dummy data - > cannot really use the yersinia ? or ask

### Tutorial section 

Maps and Trees on facets in time --- 

- getting a map
- getting the tree 
- time splitting / faceting

> Need to make the functions more general - see Yersinia ! and put that in ggtreevextra


# Creating zooms on specific clades 
## ggtree clade specific - the simple solution

> limirations 

## subsetting the tree - plotting subsets as independent tree
> see Broiler repo -> for being able to subset clades and plot individually 
> or find other solutions ! 


## Other things ?
- Finding a solution to get segments for phylogeography ...
- composite plots (tree, heatmap and other plots ...) 


--> 





